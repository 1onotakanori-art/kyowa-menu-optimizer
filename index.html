<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="食堂メニュー最適化">
  <title>食堂メニュー最適化</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="ai-styles.css">
</head>
<body>
  <div class="app-container">
    <!-- ヘッダー -->
    <header class="header">
      <h1>🍽️ メニュー最適化</h1>
      <p class="subtitle">栄養目標に最適なメニューを自動提案</p>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <!-- タブナビゲーション -->
      <div class="tabs">
        <button class="tab-button active" data-tab="input-tab">⚙️ 設定</button>
        <button class="tab-button" data-tab="menus-tab">📋 メニュー</button>
        <button class="tab-button" data-tab="result-tab">📊 結果</button>
        <button class="tab-button" data-tab="ai-menus-tab">🤖 AI</button>
      </div>

      <!-- 入力タブ -->
      <section id="input-tab" class="tab-content active">
        <div class="form-section">
          <!-- 日付と最大メニュー数（横並び） -->
          <div class="form-row">
            <!-- 日付選択 -->
            <div class="form-group">
              <label for="date-input">📅 日付</label>
              <select 
                id="date-input" 
                class="form-input"
                title="メニューが取得できた日付のみを選択可能"
              >
                <option value="">読込中...</option>
              </select>
              <small>利用可能な日付のみ表示</small>
            </div>

            <!-- 最大メニュー数 -->
            <div class="form-group">
              <label for="max-menus-input">🔢 最大メニュー数</label>
              <input 
                type="number" 
                id="max-menus-input" 
                class="form-input" 
                value="5" 
                min="1" 
                max="100"
                placeholder="5"
              >
              <small>最適化で選択する最大</small>
            </div>
          </div>

          <!-- 栄養目標 -->
          <div class="form-section-title">🎯 栄養目標</div>
          
          <div class="nutrition-grid">
            <!-- Energy -->
            <div class="nutrition-item" data-key="エネルギー">
              <span class="nutrition-name"><span class="nutrition-label">E</span>nergy</span>
              <input 
                type="number" 
                class="nutrition-value" 
                data-key="エネルギー"
                placeholder="600"
              >
              <span class="nutrition-unit">kcal</span>
            </div>

            <!-- Protein -->
            <div class="nutrition-item" data-key="たんぱく質">
              <span class="nutrition-name"><span class="nutrition-label">P</span>rotein</span>
              <input 
                type="number" 
                class="nutrition-value" 
                data-key="たんぱく質"
                placeholder="40"
              >
              <span class="nutrition-unit">g</span>
            </div>

            <!-- Fat -->
            <div class="nutrition-item" data-key="脂質">
              <span class="nutrition-name"><span class="nutrition-label">F</span>at</span>
              <input 
                type="number" 
                class="nutrition-value" 
                data-key="脂質"
                placeholder="20"
              >
              <span class="nutrition-unit">g</span>
            </div>

            <!-- Carbohydrate -->
            <div class="nutrition-item" data-key="炭水化物">
              <span class="nutrition-name"><span class="nutrition-label">C</span>arbohydrate</span>
              <input 
                type="number" 
                class="nutrition-value" 
                data-key="炭水化物"
                placeholder="95"
              >
              <span class="nutrition-unit">g</span>
            </div>

            <!-- Vegetable Weight -->
            <div class="nutrition-item" data-key="野菜重量">
              <span class="nutrition-name"><span class="nutrition-label">V</span>egetable Weight</span>
              <input 
                type="number" 
                class="nutrition-value" 
                data-key="野菜重量"
                placeholder="200"
              >
              <span class="nutrition-unit">g</span>
            </div>
          </div>

        </div>
      </section>

      <!-- メニュータブ -->
      <section id="menus-tab" class="tab-content">
        <div class="form-section">
          <!-- 上部固定バー（常に表示） -->
          <div class="menus-sticky-bar">
            <div class="menus-sticky-actions">
              <button id="optimize-button" class="button button-primary">
                🚀 最適化
              </button>

              <button id="fixed-only-result-button" class="button button-secondary">
                📊 結果表示
              </button>
            </div>

            <!-- 固定のみ集計サマリー -->
            <div id="fixed-summary" class="fixed-summary" aria-live="polite">
              <div id="fixed-summary-header" class="fixed-summary-header">
                <!-- EPFCV + 件数が6列グリッドで表示される -->
                <div id="fixed-summary-count" class="fixed-summary-count">0件</div>
              </div>
            </div>
          </div>

          <!-- メニュー一覧 -->
          <div class="form-section-title">📋 メニュー選択</div>
          <div class="menu-legend">
            <div class="legend-section">
              <div class="legend-title">メニュー状態</div>
              <div class="legend-items">
                <div class="legend-box-item"><span class="legend-box legend-recommended"></span><span class="legend-label">推奨</span></div>
                <div class="legend-box-item"><span class="legend-box legend-fixed"></span><span class="legend-label">固定</span></div>
                <div class="legend-box-item"><span class="legend-box legend-excluded"></span><span class="legend-label">除外</span></div>
              </div>
            </div>
          </div>
          
          <div class="menu-filter">
            <input 
              type="text" 
              id="menu-search" 
              class="form-input"
              placeholder="メニュー名で検索..."
            >
          </div>
          
          <div id="menus-list-container" class="menus-list-container">
            <div class="loading">
              <div class="spinner"></div>
              <p>メニュー読込中...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 結果タブ -->
      <section id="result-tab" class="tab-content">
        <div id="result-container" class="result-container">
          <!-- ローディング表示 -->
          <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>最適化中...</p>
          </div>

          <!-- エラーメッセージ -->
          <div id="error-message" class="error-message hidden"></div>

          <!-- 結果表示 -->
          <div id="result-content" class="result-content hidden">
            <!-- 日付 -->
            <div class="result-header">
              <h2 id="result-date"></h2>
              <p id="result-summary"></p>
            </div>

            <!-- サマリー -->
            <div class="summary-cards">
              <div class="summary-card">
                <div class="card-label">合計メニュー数</div>
                <div id="total-menus-count" class="card-value">0</div>
              </div>
              <div class="summary-card">
                <div class="card-label">距離スコア</div>
                <div id="distance-score" class="card-value">0</div>
              </div>
            </div>

            <!-- 合計（固定 + 提案）サマリー -->
            <div id="result-total-summary" class="fixed-summary" aria-live="polite">
              <div id="result-total-summary-header" class="fixed-summary-header">
                <div id="result-total-summary-values" class="fixed-summary-values"></div>
                <div id="result-total-summary-count" class="fixed-summary-count">0件</div>
              </div>
            </div>

            <!-- 固定メニューセクション -->
            <div id="fixed-section" class="menu-section hidden">
              <div id="fixed-menus-result" class="menus-grid"></div>
            </div>

            <!-- 追加メニューセクション -->
            <div class="menu-section">
              <div id="additional-menus-result" class="menus-grid"></div>
            </div>

            <!-- ユーザー評価セクション -->
            <div class="rating-section">
              <h3>⭐ このメニューセットはいかがでしたか？</h3>
              <p class="rating-subtitle">フィードバックをお聞かせください。個人化推奨の精度向上に役立ちます。</p>
              
              <div class="rating-container">
                <!-- メニュー選択ドロップダウン -->
                <div class="form-group">
                  <label for="rating-menu-select">📋 評価するメニューを選択</label>
                  <select id="rating-menu-select" class="form-input">
                    <option value="">メニューを選択してください</option>
                  </select>
                </div>

                <!-- スター評価 -->
                <div class="form-group">
                  <label>⭐ 評価</label>
                  <div class="star-rating">
                    <button class="star-button" data-rating="1" title="1つ星">★</button>
                    <button class="star-button" data-rating="2" title="2つ星">★★</button>
                    <button class="star-button" data-rating="3" title="3つ星">★★★</button>
                    <button class="star-button" data-rating="4" title="4つ星">★★★★</button>
                    <button class="star-button" data-rating="5" title="5つ星">★★★★★</button>
                  </div>
                  <span id="rating-display" class="rating-display">未選択</span>
                </div>

                <!-- コメント入力 -->
                <div class="form-group">
                  <label for="rating-feedback">💬 感想（オプション）</label>
                  <textarea 
                    id="rating-feedback" 
                    class="form-input" 
                    placeholder="例：味が良かった。塩辛い。野菜が少ない。など"
                    rows="3"
                  ></textarea>
                </div>

                <!-- 送信ボタン -->
                <div class="rating-buttons">
                  <button id="submit-rating-button" class="button button-primary">
                    💾 評価を送信
                  </button>
                  <button id="clear-rating-button" class="button button-secondary">
                    ✖ クリア
                  </button>
                </div>

                <!-- 評価状態メッセージ -->
                <div id="rating-message" class="rating-message"></div>
              </div>

              <!-- 評価統計 -->
              <div id="rating-stats" class="rating-stats hidden">
                <div class="stats-title">📊 あなたの評価統計</div>
                <div class="stats-content">
                  <div class="stat-item">
                    <span class="stat-label">総評価数:</span>
                    <span id="stat-total-ratings" class="stat-value">0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">平均評価:</span>
                    <span id="stat-avg-rating" class="stat-value">0.0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">評価対象メニュー:</span>
                    <span id="stat-unique-menus" class="stat-value">0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- 栄養情報 -->
            <div class="nutrition-section">
              <h3>📈 栄養情報</h3>
              <div id="nutrition-comparison" class="nutrition-table"></div>
            </div>

            <!-- ボタン群 -->
            <div class="button-group">
              <button id="re-optimize-button" class="button button-primary">
                🔄 再最適化
              </button>
              <button id="back-to-edit-button" class="button button-secondary">
                ← 設定に戻る
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- AIメニュータブ -->
      <section id="ai-menus-tab" class="tab-content">
        <div class="form-section">
          <!-- データ取得状態 -->
          <div id="ai-loading" class="loading-state" style="display: none;">
            <div class="spinner"></div>
            <p>履歴データを読み込み中...</p>
          </div>

          <!-- データなし表示 -->
          <div id="ai-no-data" class="no-data-state" style="display: none;">
            <p>📭 この日付の履歴データはありません</p>
            <small>管理者ページで記録を保存すると表示されます</small>
          </div>

          <!-- データ表示エリア -->
          <div id="ai-data-area">
            <!-- メニュー一覧 -->
            <div id="ai-menus-grid" class="menus-grid"></div>
          </div>
        </div>
      </section>

      <!-- ダッシュボードタブ -->
      <!-- ダッシュボードタブは削除（admin.htmlに移動） -->
                      <td id="score-min">-</td>
                      <td id="score-avg">-</td>
                      <td id="score-max">-</td>
                      <td id="score-std">-</td>
                    </tr>
                    <tr>
                      <td>エネルギー (kcal)</td>
                      <td id="energy-min">-</td>
                      <td id="energy-avg">-</td>
                      <td id="energy-max">-</td>
                      <td id="energy-std">-</td>
                    </tr>
                    <tr>
                      <td>タンパク質 (g)</td>
                      <td id="protein-min">-</td>
                      <td id="protein-avg">-</td>
                      <td id="protein-max">-</td>
                      <td id="protein-std">-</td>
                    </tr>
                    <tr>
                      <td>脂質 (g)</td>
                      <td id="fat-min">-</td>
                      <td id="fat-avg">-</td>
                      <td id="fat-max">-</td>
                      <td id="fat-std">-</td>
                    </tr>
                    <tr>
                      <td>炭水化物 (g)</td>
                      <td id="carbs-min">-</td>
                      <td id="carbs-avg">-</td>
                      <td id="carbs-max">-</td>
                      <td id="carbs-std">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Chart.js (栄養グラフ用) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <!-- アプリケーション JS -->
  <script src="app.js"></script>
</body>
</html>
