Matplotlib is building the font cache; this may take a moment.

======================================================================
🔍 検証スクリプト: 過学習と汎化性能の診断
======================================================================

📂 データを読み込み中...

📊 全メニュー: 22日分
📊 選択履歴: 20日分
✅ 統合可能: 20日分
📅 日付範囲: 2026-01-13 ~ 2026-02-13

✅ データ読み込み完了: 20日分

======================================================================
📈 検証戦略 1: 時系列分割
======================================================================
学習: 古い80%のデータ
検証: 新しい20%のデータ

📚 学習データ: 16日分 (2026-01-13 ~ 2026-02-09)
🧪 検証データ: 4日分 (2026-02-10 ~ 2026-02-13)

🤖 モデルを学習中...

🔧 特徴量準備中...
📚 語彙サイズ: 249 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   7回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   4回: ライス（S)
   2回: 根菜とがんもの煮付け
   2回: 茶碗蒸し
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: 小柱の炊き込みご飯
   1回: れんこんの唐辛子炒め

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   5回: is_rice + is_vegetable
   5回: is_meat + is_rice
   3回: is_meat + is_vegetable
   3回: is_healthy + is_rice
   3回: is_mini + is_vegetable

✅ 特徴量準備完了:
   サンプル数: 646
   特徴量数: 277
   正例（選択）: 52 (8.0%)
   負例（非選択）: 594 (92.0%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 0.9869 (+/- 0.0413)
RandomForest        : AUC-ROC = 0.9978 (+/- 0.0066)
GradientBoosting    : AUC-ROC = 0.9707 (+/- 0.0742)
------------------------------------------------------------
✅ 最良モデル: RandomForest (AUC-ROC = 0.9978)

🧪 検証データで評価中...


📊 時系列分割検証の結果:
   ✅ 個別メニュー精度: 46.7%
   ✅ セット類似度（Jaccard）: 0.300
   ✅ 栄養素 RMSE: 246.26
   ✅ 評価サンプル数: 4

======================================================================
📈 検証戦略 2: Leave-Future-Out交差検証
======================================================================
段階的に学習データを増やしながら検証 (5分割)


📍 Fold 1/5:
   学習: 2026-01-13 ~ 2026-01-16 (3日)
   検証: 2026-01-19 ~ 2026-01-21 (3日)

🔧 特徴量準備中...
📚 語彙サイズ: 63 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   2回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: ライス（S)
   1回: 小柱の炊き込みご飯
   1回: 根菜とがんもの煮付け
   1回: れんこんの唐辛子炒め
   1回: 5品目野菜とトマトのミネストローネ

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   2回: is_rice + is_vegetable
   1回: is_rice + is_tofu
   1回: is_tofu + is_vegetable
   1回: is_meat + is_rice
   1回: is_healthy + is_rice

✅ 特徴量準備完了:
   サンプル数: 120
   特徴量数: 91
   正例（選択）: 12 (10.0%)
   負例（非選択）: 108 (90.0%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 1.0000 (+/- 0.0000)
RandomForest        : AUC-ROC = 1.0000 (+/- 0.0000)
GradientBoosting    : AUC-ROC = 1.0000 (+/- 0.0000)
------------------------------------------------------------
✅ 最良モデル: LogisticRegression (AUC-ROC = 1.0000)
   ✅ Menu Accuracy: 45.5%
   ✅ Set Jaccard: 0.311
   ✅ Nutrition RMSE: 234.98

📍 Fold 2/5:
   学習: 2026-01-13 ~ 2026-01-21 (6日)
   検証: 2026-01-22 ~ 2026-01-26 (3日)

🔧 特徴量準備中...
📚 語彙サイズ: 104 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   3回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   3回: ライス（S)
   2回: 茶碗蒸し
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: 小柱の炊き込みご飯
   1回: 根菜とがんもの煮付け
   1回: れんこんの唐辛子炒め

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   3回: is_meat + is_rice
   2回: is_rice + is_vegetable
   2回: is_healthy + is_rice
   2回: is_mini + is_rice
   1回: is_rice + is_tofu

✅ 特徴量準備完了:
   サンプル数: 243
   特徴量数: 132
   正例（選択）: 23 (9.5%)
   負例（非選択）: 220 (90.5%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 0.9985 (+/- 0.0033)
RandomForest        : AUC-ROC = 1.0000 (+/- 0.0000)
GradientBoosting    : AUC-ROC = 0.9978 (+/- 0.0049)
------------------------------------------------------------
✅ 最良モデル: RandomForest (AUC-ROC = 1.0000)
   ✅ Menu Accuracy: 14.3%
   ✅ Set Jaccard: 0.067
   ✅ Nutrition RMSE: 182.08

📍 Fold 3/5:
   学習: 2026-01-13 ~ 2026-01-26 (9日)
   検証: 2026-01-27 ~ 2026-01-29 (3日)

🔧 特徴量準備中...
📚 語彙サイズ: 148 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   4回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   3回: ライス（S)
   2回: 茶碗蒸し
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: 小柱の炊き込みご飯
   1回: 根菜とがんもの煮付け
   1回: れんこんの唐辛子炒め

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   3回: is_rice + is_vegetable
   3回: is_meat + is_rice
   2回: is_healthy + is_rice
   2回: is_mini + is_rice
   2回: is_mini + is_vegetable

✅ 特徴量準備完了:
   サンプル数: 364
   特徴量数: 176
   正例（選択）: 30 (8.2%)
   負例（非選択）: 334 (91.8%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 0.9985 (+/- 0.0041)
RandomForest        : AUC-ROC = 1.0000 (+/- 0.0000)
GradientBoosting    : AUC-ROC = 0.9708 (+/- 0.0782)
------------------------------------------------------------
✅ 最良モデル: RandomForest (AUC-ROC = 1.0000)
   ✅ Menu Accuracy: 44.4%
   ✅ Set Jaccard: 0.267
   ✅ Nutrition RMSE: 112.81

📍 Fold 4/5:
   学習: 2026-01-13 ~ 2026-01-29 (12日)
   検証: 2026-01-30 ~ 2026-02-03 (3日)

🔧 特徴量準備中...
📚 語彙サイズ: 196 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   6回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   3回: ライス（S)
   2回: 茶碗蒸し
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: 小柱の炊き込みご飯
   1回: 根菜とがんもの煮付け
   1回: れんこんの唐辛子炒め

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   5回: is_rice + is_vegetable
   4回: is_meat + is_rice
   3回: is_healthy + is_rice
   3回: is_mini + is_vegetable
   2回: is_meat + is_vegetable

✅ 特徴量準備完了:
   サンプル数: 486
   特徴量数: 224
   正例（選択）: 39 (8.0%)
   負例（非選択）: 447 (92.0%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 0.9891 (+/- 0.0293)
RandomForest        : AUC-ROC = 1.0000 (+/- 0.0000)
GradientBoosting    : AUC-ROC = 1.0000 (+/- 0.0000)
------------------------------------------------------------
✅ 最良モデル: RandomForest (AUC-ROC = 1.0000)
   ✅ Menu Accuracy: 63.6%
   ✅ Set Jaccard: 0.456
   ✅ Nutrition RMSE: 134.10

📍 Fold 5/5:
   学習: 2026-01-13 ~ 2026-02-03 (15日)
   検証: 2026-02-09 ~ 2026-02-11 (3日)

🔧 特徴量準備中...
📚 語彙サイズ: 230 単語

📈 共起分析中...
📊 よく選ばれるメニュー TOP 10:
   7回: たんぱく質の摂れる小鉢 蒸し鶏＆ブロッコリー
   4回: ライス（S)
   2回: 根菜とがんもの煮付け
   2回: 茶碗蒸し
   1回: 海鮮丼
   1回: 大豆とひじきの煮付
   1回: あじの香味焼き
   1回: 蓮根たっぷりプルコギ風炒め
   1回: 小柱の炊き込みご飯
   1回: れんこんの唐辛子炒め

📊 よく一緒に選ばれるカテゴリ組み合わせ:
   5回: is_rice + is_vegetable
   5回: is_meat + is_rice
   3回: is_meat + is_vegetable
   3回: is_healthy + is_rice
   3回: is_mini + is_vegetable

✅ 特徴量準備完了:
   サンプル数: 606
   特徴量数: 258
   正例（選択）: 50 (8.3%)
   負例（非選択）: 556 (91.7%)

🤖 モデル学習中...

📊 Leave-One-Day-Out クロスバリデーション結果:
------------------------------------------------------------
LogisticRegression  : AUC-ROC = 0.9904 (+/- 0.0298)
RandomForest        : AUC-ROC = 0.9995 (+/- 0.0018)
GradientBoosting    : AUC-ROC = 0.9489 (+/- 0.1350)
------------------------------------------------------------
✅ 最良モデル: RandomForest (AUC-ROC = 0.9995)
   ✅ Menu Accuracy: 33.3%
   ✅ Set Jaccard: 0.178
   ✅ Nutrition RMSE: 285.78

======================================================================
📊 結果をグラフで可視化中...
======================================================================

✅ グラフを保存: /Users/onotakanori/Apps/kyowa-menu-optimizer/ml/validation_results.png

📈 Leave-Future-Out交差検証の統計:
   メニュー精度: 40.2% ± 16.2%
   セット類似度: 0.256 ± 0.130
   栄養素RMSE: 189.95 ± 63.78

✅ 結果を保存: /Users/onotakanori/Apps/kyowa-menu-optimizer/ml/validation_results.json

======================================================================
🔍 診断結果
======================================================================

✅ メトリクスの解釈:
   - Menu Accuracy: 個別メニューの予測精度（高いほど良い）
   - Set Jaccard: 予測セットと実際のセットの類似度（0-1, 高いほど良い）
   - Nutrition RMSE: 栄養素の予測誤差（低いほど良い）

📊 過学習の兆候:
   - Foldが進むにつれてメトリクスが悪化 → 過学習の可能性
   - 検証精度が低い → 未来データへの汎化性能が低い
   - RMSE が大きく変動 → モデルが不安定

💡 次のステップ:
   1. 過学習が確認できたら → Seq2Set Transformer を検討
   2. 汎化性能が十分なら → より複雑なモデルで性能向上を試みる
   3. どちらでも → メニュー間の相互作用を明示的にモデル化

詳細は validation_results.json と validation_results.png を確認してください。
    
======================================================================

