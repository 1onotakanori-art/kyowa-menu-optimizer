# UI改善記録 & TODO

最終更新: 2026年1月14日

## ✅ 完了した修正（2026/01/14）

### 1. iPhone ブラウザの拡大防止
- **問題**: 数値入力時に画面が拡大され、全体が見づらくなる
- **解決**: `viewport` の `user-scalable=no`, `maximum-scale=1.0` を設定
- **ファイル**: `index.html`
- **影響**: 入力時の拡大が無効化され、スムーズな操作が可能に

### 2. メニュー表示数の制限解除
- **問題**: メニューが10個しか表示されない
- **原因**: `selectMenusByGreedy` の引数が固定で `10` になっていた
- **解決**: `availableMenus.length` に変更し、全メニューを対象に
- **ファイル**: `app.js`
- **影響**: 全メニューが最適化の候補として表示される

### 3. 野菜重量の略称変更
- **変更**: `VW` → `V`
- **ファイル**: `app.js`
- **影響**: メニュー表示が簡潔に

### 4. 栄養目標の UI 大幅改善
#### 4-1. 英語表記への変更
- エネルギー → **E**nergy
- たんぱく質 → **P**rotein
- 脂質 → **F**at
- 炭水化物 → **C**arbohydrate
- 野菜重量 → **V**egetable Weight

#### 4-2. レイアウト変更（横並び → 縦並び）
- グリッドレイアウトを `grid-template-columns: 1fr` に変更
- 各項目が1行で表示される（項目名、単位、入力欄が横一列）

#### 4-3. 頭文字の強調表示
- 各栄養項目の頭文字を `.nutrition-label` で色付け（青系統）
- メニュー表示の P, F, C, V と対応する色にする予定

#### 4-4. タップ選択化
- チェックボックス廃止
- 枠全体をタップで選択/解除
- 選択時は枠が青くなり、入力フィールドが表示される
- 未選択時は数値が非表示（プレースホルダーも非表示）

**ファイル**: `index.html`, `style.css`, `app.js`

### 5. メニュー表示の表形式化
#### 5-1. ボタン廃止・枠色判別に変更
- ⭕️/➕/❌ ボタンを削除
- 枠の左側の色で状態を判別
  - **緑枠**: 推奨（デフォルト）= 最適化の選択肢に含める
  - **青枠**: 固定 = 必ず含める
  - **赤枠**: 除外 = 含めない
- タップで状態を循環的に切り替え（推奨 → 固定 → 除外 → 推奨）

#### 5-2. 栄養成分の背景色設定
- **P（たんぱく質）**: 赤系統 (`#e74c3c`)
- **F（脂質）**: 黄色系統 (`#f39c12`)
- **C（炭水化物）**: 青系統 (`#3498db`)
- **V（野菜重量）**: 緑系統 (`#27ae60`)

#### 5-3. メニュー情報の表示順
1. メニュー名（太字）
2. 価格（円表記）
3. 栄養成分（P, F, C, V が横一列、背景色付き）

**ファイル**: `app.js`, `style.css`

### 6. ボタン説明（凡例）の追加
- メニュー選択セクションの上部に凡例を表示
- ⭕️ 固定（必ず含める）
- ➕ 推奨
- ❌ 除外
- 青系統の背景色で見やすく

**ファイル**: `index.html`, `style.css`

### 7. 最適化ボタンの配置変更
- メニュー選択の**上**に移動
- 理由: 何も選択せずに最適化する可能性があるため、アクセスしやすい位置に

**ファイル**: `index.html`

### 8. 最適化後の自動タブ切り替え
- 最適化実行後、自動で「結果」タブに切り替わる
- タブ切り替えの混乱を防ぐ

**ファイル**: `app.js`

### 9. 結果表示のメニュー形式統一
- 設定画面と同じ表形式を採用
- 固定メニュー = 青枠
- 提案メニュー = 緑枠
- 除外ボタン（✕）は右側に表示

**ファイル**: `app.js`, `style.css`

---

## 🔧 追加で必要な修正項目

### 🔴 優先度: 高

#### 1. メニューの価格取得（スクレイパー対応）
- **現状**: 価格が取得できていない（スクレイパーが栄養情報のみ取得）
- **必要な情報**:
  - Kyowa メニューサイト（`https://kyowa2407225.uguide.info`）で価格が表示されている DOM 要素
  - 価格の HTML クラス名 or ID
  - 価格の位置（例：メニュー名の下、右側など）
- **対象ファイル**: `src/scraper/fetchMenus.js`
- **実装手順**:
  1. 価格の DOM セレクタを特定
  2. `scrapeMenus()` 関数内で価格を取得
  3. `nutrition` オブジェクトに `価格` キーを追加
  4. 再スクレイプ実行（`node prescrap.js`）

#### 2. 栄養目標の頭文字色の統一
- **現状**: 栄養目標の頭文字（E, P, F, C, V）が青系統のみ
- **要求**: メニュー表示の P, F, C, V と同じ色系統を使用
  - **E**: エネルギー用の色（未定義）
  - **P**: 赤系統 (`#e74c3c`)
  - **F**: 黄色系統 (`#f39c12`)
  - **C**: 青系統 (`#3498db`)
  - **V**: 緑系統 (`#27ae60`)
- **対象ファイル**: `style.css`
- **実装**: `.nutrition-label` に個別のクラスを追加（`.nutrition-label-p`, `.nutrition-label-f` など）

### 🟡 優先度: 中

#### 3. 結果表示の改善
##### 3-1. 合計価格と栄養合計の表示
- **表示位置**: 「合計メニュー数」と「距離スコア」の下
- **表示内容**:
  - 合計価格（円表記）
  - 選択された栄養目標の合計値
  - 選択された栄養はハイライト表示
- **対象ファイル**: `app.js`, `index.html`, `style.css`

##### 3-2. 固定メニューと提案メニューの統合表示
- **現状**: 固定メニューと提案メニューが別セクション
- **要求**: 色で判別できるため、1つのリストに統合
  - 青枠 = 固定メニュー
  - 緑枠 = 提案メニュー
- **対象ファイル**: `index.html`, `app.js`

##### 3-3. グラフ表示の確認
- **現状**: Chart.js が読み込まれている
- **要確認**: グラフが正しく表示されるか
- **対象ファイル**: `app.js` の `displayNutritionComparison()`

### 🟢 優先度: 低

#### 4. スクロール最適化
- **問題**: メニュー一覧のスクロールが二重になっている可能性
- **確認事項**:
  - `.menus-list-container` の `max-height: 500px` が適切か
  - `-webkit-overflow-scrolling: touch` の動作確認
- **対象ファイル**: `style.css`

#### 5. アクセシビリティ改善
- **確認事項**:
  - 色覚異常者への配慮（P, F, C, V の色選択）
  - スクリーンリーダー対応（ARIA ラベル）
  - コントラスト比の確認

---

## ❓ 確認待ち項目

### 1. 価格取得の DOM 構造
**質問**: Kyowa メニューサイトで価格はどこに表示されていますか？
- ブラウザの開発者ツールで確認していただくか
- スクリーンショットを共有していただけると助かります

### 2. デプロイ確認
**GitHub Pages URL**: https://1onotakanori-art.github.io/kyowa-menu-optimizer/

**確認項目**:
- ✅ 栄養目標が英語・縦並び（E, P, F, C, V が色付き）
- ✅ メニューが全数表示され、タップで色が変わる
- ✅ ボタンの説明（凡例）が見やすい
- ✅ iPhone での拡大が防止されている
- ✅ スクロールが二重になっていない

---

## 📝 実装メモ

### メニュー状態の循環
```
推奨（緑枠・デフォルト） 
  ↓ タップ
固定（青枠）
  ↓ タップ
除外（赤枠）
  ↓ タップ
推奨（緑枠）に戻る
```

### 栄養成分の色定義
```css
.nutrition-p { background-color: #e74c3c; } /* 赤系統 */
.nutrition-f { background-color: #f39c12; } /* 黄色系統 */
.nutrition-c { background-color: #3498db; } /* 青系統 */
.nutrition-v { background-color: #27ae60; } /* 緑系統 */
```

### 変更されたファイル一覧
- `index.html` - 栄養目標の HTML 構造、ボタン配置
- `style.css` - 栄養目標のレイアウト、メニュー表示スタイル
- `app.js` - メニュー表示ロジック、状態管理、結果表示

---

## 🚀 次のステップ

1. **価格取得の実装**: DOM 構造を確認してスクレイパーを修正
2. **デプロイ確認**: iPhone で動作確認
3. **結果表示の改善**: 合計価格・栄養合計の表示
4. **色の統一**: 栄養目標の頭文字色をメニュー表示と合わせる
