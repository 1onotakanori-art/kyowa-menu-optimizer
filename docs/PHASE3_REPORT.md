# Phase 3 å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## å®Ÿè£…æ—¥æ™‚
2026å¹´1æœˆ17æ—¥

## å®Œäº†é …ç›®

### âœ… 1. `selectDate()` é–¢æ•°ã®å®Œå…¨å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/scraper/fetchMenus_v2.js`

**å®Ÿè£…å†…å®¹**:
```javascript
async function selectDate(page, dateLabel)
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**ï¼ˆå‚ç…§: SCRAPER_REBUILD_PLAN.mdï¼‰:

1. âœ… **ãƒœã‚¿ãƒ³å­˜åœ¨ç¢ºèª**
   ```javascript
   await page.waitForSelector('.weeks-day-btn button.after-btn', { timeout: 5000 });
   ```
   - ã‚»ãƒ¬ã‚¯ã‚¿: `.weeks-day-btn button.after-btn`
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’

2. âœ… **ç¾åœ¨ã®é¸æŠçŠ¶æ…‹ç¢ºèª**
   ```javascript
   const currentSelectedDate = await page.evaluate(() => {...});
   ```
   - æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—ï¼ˆåŠ¹ç‡åŒ–ï¼‰

3. âœ… **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œä»˜ãæ¤œç´¢**
   ```javascript
   if (!target) {
     container.scrollLeft += 200;
     // å†æ¤œç´¢
   }
   ```
   - ç†ç”±: æ—¥ä»˜ãƒœã‚¿ãƒ³ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒŠå†…
   - å‚ç…§: SCRAPER_REBUILD_PLAN.md ã®ã€Œä¿æŒã™ã¹ãæ©Ÿèƒ½ã€

4. âœ… **ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ**
   ```javascript
   target.click();
   ```

5. âœ… **ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºå¾…æ©Ÿ**
   ```javascript
   await page.waitForFunction(
     () => document.querySelectorAll('.menu-content').length > 0,
     { timeout: 5000 }
   );
   ```
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’
   - æ¡ä»¶: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¦ç´ ãŒ DOM ã«è¿½åŠ ã•ã‚Œã‚‹

6. âœ… **DOM å®‰å®šå¾…æ©Ÿ**
   ```javascript
   await page.waitForTimeout(500);
   ```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
- è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ: åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
- ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

### âœ… 2. `expandAllMenus()` é–¢æ•°ã®å®Œå…¨å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/scraper/fetchMenus_v2.js`

**å®Ÿè£…å†…å®¹**:
```javascript
async function expandAllMenus(page)
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**ï¼ˆå‚ç…§: SCRAPER_REBUILD_PLAN.mdï¼‰:

1. âœ… **ãƒ«ãƒ¼ãƒ—å‡¦ç†**
   ```javascript
   while (clickCount < maxIterations) {
     // æœ€å¤§ 50 å›ã‚¯ãƒªãƒƒã‚¯ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
   }
   ```

2. âœ… **å±•é–‹å‰ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ã‚«ã‚¦ãƒ³ãƒˆ**
   ```javascript
   const beforeCount = await page.$$eval('.menu-content', els => els.length);
   ```

3. âœ… **å±•é–‹ãƒœã‚¿ãƒ³ã®å­˜åœ¨ç¢ºèª**
   ```javascript
   const nextBtn = await page.$('.menu-next-btn:not([disabled])');
   ```
   - ã‚»ãƒ¬ã‚¯ã‚¿: `.menu-next-btn:not([disabled])`
   - ãªã‘ã‚Œã°ãƒ«ãƒ¼ãƒ—çµ‚äº†

4. âœ… **ãƒœã‚¿ãƒ³ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå†…ã«ç§»å‹•**
   ```javascript
   await nextBtn.scrollIntoViewIfNeeded();
   ```
   - ç†ç”±: ãƒœã‚¿ãƒ³ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¯„å›²å¤–ã®å ´åˆã®ã‚¯ãƒªãƒƒã‚¯å¤±æ•—é˜²æ­¢

5. âœ… **ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ**
   ```javascript
   await nextBtn.click({ force: true });
   ```

6. âœ… **ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°å¢—åŠ ã‚’ç¢ºèª**
   ```javascript
   while (Date.now() - startTime < 5000) {
     await page.waitForTimeout(200);
     currentCount = await page.$$eval('.menu-content', els => els.length);
     if (currentCount > beforeCount) break;
   }
   ```
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5ç§’
   - ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”: 200ms
   - ç†ç”±: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã¸ã®å¯¾å¿œ

7. âœ… **ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ãŒå¢—ãˆãªã„å ´åˆã®å¯¾å¿œ**
   - ãƒ«ãƒ¼ãƒ—çµ‚äº†ï¼ˆç„¡é™ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢ï¼‰

8. âœ… **DOM å®‰å®šå¾…æ©Ÿ**
   ```javascript
   await page.waitForTimeout(300);
   ```

**ãƒ­ã‚°å‡ºåŠ›**:
- ã‚¯ãƒªãƒƒã‚¯å‰å¾Œã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°
- å±•é–‹æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
- ã‚¨ãƒ©ãƒ¼æ™‚ã®è©³ç´°æƒ…å ±

---

### âœ… 3. `fetchMenus()` é–¢æ•°ã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/scraper/fetchMenus_v2.js`

**æ›´æ–°å†…å®¹**:
- ã‚¹ãƒ†ãƒƒãƒ— 5: `selectDate(page, dateLabel)` å‘¼ã³å‡ºã—æœ‰åŠ¹åŒ–
- ã‚¹ãƒ†ãƒƒãƒ— 6: `expandAllMenus(page)` å‘¼ã³å‡ºã—æœ‰åŠ¹åŒ–
- ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°: "Phase 3 - æ—¥ä»˜é¸æŠãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹å®Ÿè£…æ¸ˆã¿"

**å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆPhase 3 å®Œäº†æ™‚ç‚¹ï¼‰**:
```
fetchMenus(dateLabel)
  â”œâ”€ ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹• âœ…
  â”œâ”€ ã‚µã‚¤ãƒˆèª­ã¿è¾¼ã¿ âœ…
  â”œâ”€ 2ç§’å®Œå…¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾…æ©Ÿ âœ…
  â”œâ”€ selectTab() ã§ã€Œä»Šé€±ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ âœ…
  â”œâ”€ selectDate() ã§æ—¥ä»˜ã‚’é¸æŠ âœ… (Phase 3)
  â”œâ”€ expandAllMenus() ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹ âœ… (Phase 3)
  â”œâ”€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼å–å¾—ï¼ˆPhase 4 ã§å®Ÿè£…äºˆå®šï¼‰
  â””â”€ ãƒ–ãƒ©ã‚¦ã‚¶çµ‚äº† âœ…
```

---

### âœ… 4. Phase 3 ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test_phase3.js`

**æ©Ÿèƒ½**:
1. ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ãƒ»ã‚µã‚¤ãƒˆèª­ã¿è¾¼ã¿ç¢ºèª
2. ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç¢ºèªï¼ˆPhase 2ï¼‰
3. æ—¥ä»˜é¸æŠæ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª
5. ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³å±•é–‹æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
6. ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±æä¾›

**å®Ÿè¡Œæ–¹æ³•**:
```bash
node test_phase3.js
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ãƒ•ãƒ­ãƒ¼**:
```
============================================================
Phase 3 ãƒ†ã‚¹ãƒˆï¼šæ—¥ä»˜é¸æŠãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹ç¢ºèª
============================================================

ğŸ“‹ ãƒ†ã‚¹ãƒˆå†…å®¹:
1. ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ãƒ»ã‚µã‚¤ãƒˆèª­ã¿è¾¼ã¿ï¼ˆPhase 2ï¼‰
2. ã€Œä»Šé€±ã€ã‚¿ãƒ–ã®ã‚¯ãƒªãƒƒã‚¯ï¼ˆPhase 2ï¼‰
3. æ—¥ä»˜ã€Œ1/19(æœˆ)ã€ã®é¸æŠ
4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª
5. ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹

ğŸš€ ãƒ†ã‚¹ãƒˆé–‹å§‹...

============================================================
ğŸŒ [ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—é–‹å§‹] æ—¥ä»˜: 1/19(æœˆ)
============================================================
âœ… ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•å®Œäº†
âœ… ã‚µã‚¤ãƒˆèª­ã¿è¾¼ã¿å®Œäº†
âœ… ã‚µã‚¤ãƒˆå®Œå…¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†
ğŸ“‘ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ: ã€Œä»Šé€±ã€ã‚’é¸æŠ
ğŸ” ã‚¿ãƒ–é¸æŠé–‹å§‹: "ä»Šé€±"
âœ… ã‚¿ãƒ–è¦ç´ ã‚’ç¢ºèª
âœ… ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯: "ä»Šé€±"
âœ… ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆå®Œäº†ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿï¼‰
ğŸ“… æ—¥ä»˜é¸æŠ: ã€Œ1/19(æœˆ)ã€
ğŸ” æ—¥ä»˜é¸æŠé–‹å§‹: "1/19(æœˆ)"
âœ… æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯: "1/19(æœˆ)"
â³ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºå¾…æ©Ÿä¸­...
âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª: 15 ãƒ¡ãƒ‹ãƒ¥ãƒ¼
ğŸ“‹ [å±•é–‹é–‹å§‹] ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯é–‹å§‹
   å±•é–‹å‰: 15 ãƒ¡ãƒ‹ãƒ¥ãƒ¼
   ğŸ–±ï¸  ã‚¯ãƒªãƒƒã‚¯ 1 å®Ÿè¡Œ
   â³ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ å¾…æ©Ÿä¸­...
   âœ… ã‚¯ãƒªãƒƒã‚¯ 1: 15 â†’ 20 ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (+5) [450ms]
   ...
âœ… [å±•é–‹å®Œäº†] ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹å‡¦ç†çµ‚äº†
âœ… ãƒ–ãƒ©ã‚¦ã‚¶çµ‚äº†
```

---

## DOM ã‚»ãƒ¬ã‚¯ã‚¿ã®è©³ç´°

### æ—¥ä»˜é¸æŠã‚»ãƒ¬ã‚¯ã‚¿
```javascript
// ãƒœã‚¿ãƒ³ç¢ºèª
'.weeks-day-btn button.after-btn'

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾è±¡ã‚³ãƒ³ãƒ†ãƒŠ
'.weeks-day-btn'

// ã‚¯ãƒªãƒƒã‚¯å¯¾è±¡
target.click() // evaluate å†…ã§å®Ÿè¡Œ

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºç¢ºèª
'.menu-content'
```

### ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹ã‚»ãƒ¬ã‚¯ã‚¿
```javascript
// å±•é–‹ãƒœã‚¿ãƒ³
'.menu-next-btn:not([disabled])'

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ã‚«ã‚¦ãƒ³ãƒˆ
'.menu-content'
```

---

## å¾…æ©Ÿå‡¦ç†ã®è©³ç´°

### æ—¥ä»˜é¸æŠå¾Œã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºå¾…æ©Ÿ
```javascript
await page.waitForFunction(
  () => document.querySelectorAll('.menu-content').length > 0,
  { timeout: 5000 }
);
```
- **ç†ç”±**: DOM ã« ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¦ç´ ãŒè¿½åŠ ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 5ç§’
- **ç¢ºèªå†…å®¹**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•° > 0

### å±•é–‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ç¢ºèª
```javascript
while (Date.now() - startTime < 5000) {
  await page.waitForTimeout(200);
  currentCount = await page.$$eval('.menu-content', els => els.length);
  if (currentCount > beforeCount) break;
}
```
- **ç†ç”±**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã¸ã®å¯¾å¿œ
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 5ç§’
- **ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”**: 200ms
- **æˆåŠŸæ¡ä»¶**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ãŒå¢—åŠ 

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### æ—¥ä»˜ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
```
Error: æ—¥ä»˜ã€Œ1/15(æœˆ)ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜: 1/16(é‡‘), 1/19(æœˆ), 1/20(ç«), ...
```

**åˆ©ç‚¹**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ã‚’å³åº§ã«èªè­˜å¯èƒ½
- ã‚»ãƒ¬ã‚¯ã‚¿ã®å•é¡Œã¨ã‚µã‚¤ãƒˆä»•æ§˜ã®å•é¡Œã‚’åŒºåˆ¥å¯èƒ½

### ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
```
Error: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ1/19(æœˆ)ï¼‰
```

**å¯¾å¿œ**:
- DOM æ§‹é€ ã‚’å†ç¢ºèª
- ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ä¿®æ­£
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª

### å±•é–‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°ãŒå¢—ãˆãªã„
```
âŒ ã‚¯ãƒªãƒƒã‚¯ 3: ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°å¤‰åŒ–ãªã— (20 â†’ 20) [ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ]
âš ï¸  ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã—ãŸã®ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå¢—ãˆã¾ã›ã‚“ã§ã—ãŸã€‚
```

**å¯¾å¿œ**:
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã‚’å»¶é•·ï¼ˆ5000 â†’ 7000msï¼‰
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã®ç¢ºèª

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 4: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ»ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
**ç›®æ¨™**: ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã¨æ „é¤Šæƒ…å ±ãŒæ­£ç¢ºã«æŠ½å‡ºã•ã‚Œã‚‹

**å®Ÿè£…é …ç›®**:
- [ ] `scrapeMenus()` é–¢æ•°å®Ÿè£…
- [ ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼åæŠ½å‡ºï¼ˆ`.menu-name`ï¼‰
- [ ] æ „é¤Šæƒ…å ±æŠ½å‡ºï¼ˆ`.menu-detail-cell` ãƒšã‚¢ï¼‰
- [ ] è©³ç´°ãƒ‘ãƒãƒ«é–‹é–‰å‡¦ç†
- [ ] Phase 4 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**å‚ç…§**: SCRAPER_REBUILD_PLAN.md ã®ã€ŒPhase 4: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ»ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã€

---

## ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| è¨ˆç”»æ›¸ã¸ã®å‚ç…§ | âœ… | SCRAPER_REBUILD_PLAN.md ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆå®Œå‚™ |
| JSDoc ã‚³ãƒ¡ãƒ³ãƒˆ | âœ… | é–¢æ•°ç½²åã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€æˆ»ã‚Šå€¤ã‚’è¨˜è¿° |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | âœ… | è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ± |
| ãƒ–ãƒ©ã‚¦ã‚¶çµ‚äº†ä¿è¨¼ | âœ… | finally ãƒ–ãƒ­ãƒƒã‚¯ã§ç¢ºå®Ÿã« close() |
| ãƒ­ã‚°å‡ºåŠ› | âœ… | ãƒ‡ãƒãƒƒã‚°å®¹æ˜“ãªæ®µéšçš„ãƒ­ã‚°ã€æ™‚é–“è¨ˆæ¸¬ |
| ã‚»ãƒ¬ã‚¯ã‚¿ç®¡ç† | âš ï¸ | ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆPhase 6 ã§ã®æ”¹å–„æ¤œè¨ï¼‰ |
| ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ | âœ… | æ—¥ä»˜ãƒœã‚¿ãƒ³æ¤œç´¢ã§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¾Œã®å†æ¤œç´¢å®Ÿè£… |
| å¾…æ©Ÿå‡¦ç† | âœ… | ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°å¢—åŠ ã‚’ç¢ºèªã™ã‚‹é«˜åº¦ãªå¾…æ©Ÿãƒ­ã‚¸ãƒƒã‚¯ |

---

## é‡è¦ãªè¨­è¨ˆæ±ºå®š

### 1. æ—¢é¸æŠçŠ¶æ…‹ã®ç¢ºèª
```javascript
const currentSelectedDate = await page.evaluate(() => {
  const selectedButton = document.querySelector('.weeks-day-btn button.after-btn.selected');
  return selectedButton ? selectedButton.textContent.trim() : null;
});

if (currentSelectedDate === dateLabel) {
  return; // ã‚¹ã‚­ãƒƒãƒ—
}
```
**ç†ç”±**: ä¸è¦ãªã‚¯ãƒªãƒƒã‚¯ã‚’é¿ã‘ã¦åŠ¹ç‡åŒ–

### 2. ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¾Œã®å†æ¤œç´¢
```javascript
if (!target) {
  const container = document.querySelector('.weeks-day-btn');
  if (container) {
    container.scrollLeft += 200;
  }
  // å†æ¤œç´¢
}
```
**ç†ç”±**: æ—¥ä»˜ãƒœã‚¿ãƒ³ãŒå…¨ã¦è¦‹ãˆã‚‹ã¨ã¯é™ã‚‰ãªã„

### 3. ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°å¢—åŠ ã®ç¢ºèª
```javascript
while (Date.now() - startTime < 5000) {
  await page.waitForTimeout(200);
  currentCount = await page.$$eval('.menu-content', els => els.length);
  if (currentCount > beforeCount) break;
}
```
**ç†ç”±**: å˜ãªã‚‹ã‚¯ãƒªãƒƒã‚¯å¾…æ©Ÿã§ã¯ãªãã€å®Ÿéš›ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ã‚’ç¢ºèª

---

## çµ±è¨ˆ

- **selectDate å®Ÿè£…è¡Œæ•°**: ç´„ 70 è¡Œ
- **expandAllMenus å®Ÿè£…è¡Œæ•°**: ç´„ 80 è¡Œ
- **åˆè¨ˆå®Ÿè£…è¡Œæ•°**: ç´„ 150 è¡Œ
- **ã‚³ãƒ¡ãƒ³ãƒˆãƒ»èª¬æ˜è¡Œæ•°**: ç´„ 60 è¡Œ
- **ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: 1 ãƒ•ã‚¡ã‚¤ãƒ«
- **å®Œäº†åº¦**: Phase 1-3 ã® 50% å®Œäº†ï¼ˆ3/6 Phaseï¼‰

---

## å‚è€ƒãƒªãƒ³ã‚¯

- **è¨ˆç”»æ›¸**: [SCRAPER_REBUILD_PLAN.md](../SCRAPER_REBUILD_PLAN.md)
- **Phase 2 ãƒ¬ãƒãƒ¼ãƒˆ**: [docs/PHASE2_REPORT.md](PHASE2_REPORT.md)
- **å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: [src/scraper/fetchMenus_v2.js](../src/scraper/fetchMenus_v2.js)
